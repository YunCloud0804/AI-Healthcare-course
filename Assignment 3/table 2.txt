SELECT
    ADMISSIONS.ETHNICITY,
    COUNT(DIAGNOSES_ICD.SUBJECT_ID) AS Patient_Count
FROM
    DIAGNOSES_ICD
JOIN
    ADMISSIONS ON DIAGNOSES_ICD.HADM_ID = ADMISSIONS.HADM_ID
WHERE
    DIAGNOSES_ICD.ICD9_CODE LIKE '584%'
GROUP BY
    ADMISSIONS.ETHNICITY
ORDER BY
    Patient_Count DESC
LIMIT 8;

------------------------------------------

SELECT
    FLOOR(EXTRACT(YEAR FROM AGE(ADMISSIONS.ADMITTIME, PATIENTS.DOB)) / 10) * 10 AS Age_Group,
    COUNT(CASE WHEN ADMISSIONS.ETHNICITY = 'WHITE' THEN 1 END) AS White_Count,
    COUNT(CASE WHEN ADMISSIONS.ETHNICITY = 'BLACK/AFRICAN AMERICAN' THEN 1 END) AS Black_African_American_Count,
    COUNT(CASE WHEN ADMISSIONS.ETHNICITY = 'UNKNOWN/NOT SPECIFIED' THEN 1 END) AS Unknown_Not_Specified_Count,
    COUNT(CASE WHEN ADMISSIONS.ETHNICITY = 'HISPANIC OR LATINO' THEN 1 END) AS Hispanic_Or_Latino_Count,
    COUNT(CASE WHEN ADMISSIONS.ETHNICITY = 'OTHER' THEN 1 END) AS Other_Count,
    COUNT(CASE WHEN ADMISSIONS.ETHNICITY = 'UNABLE TO OBTAIN' THEN 1 END) AS Unable_To_Obtain_Count,
    COUNT(CASE WHEN ADMISSIONS.ETHNICITY = 'ASIAN' THEN 1 END) AS Asian_Count,
    COUNT(CASE WHEN ADMISSIONS.ETHNICITY = 'PATIENT DECLINED TO ANSWER' THEN 1 END) AS Patient_Declined_To_Answer_Count
FROM
    DIAGNOSES_ICD
JOIN
    ADMISSIONS ON DIAGNOSES_ICD.HADM_ID = ADMISSIONS.HADM_ID
JOIN
    PATIENTS ON DIAGNOSES_ICD.SUBJECT_ID = PATIENTS.SUBJECT_ID
WHERE
    DIAGNOSES_ICD.ICD9_CODE LIKE '584%'  -- Filtering for acute kidney failure diagnosis
GROUP BY
    Age_Group
ORDER BY
    Age_Group;
