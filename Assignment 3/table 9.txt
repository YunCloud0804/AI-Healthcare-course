SELECT
    D_ICD_DIAGNOSES.SHORT_TITLE AS Comorbidity,
    COUNT(DISTINCT DIAGNOSES_ICD.SUBJECT_ID) AS Patient_Count,
    COUNT(DISTINCT CASE WHEN INPUTEVENTS_MV.PATIENTWEIGHT < 40 THEN INPUTEVENTS_MV.SUBJECT_ID END) AS "0-40",
    COUNT(DISTINCT CASE WHEN INPUTEVENTS_MV.PATIENTWEIGHT BETWEEN 40 AND 49.9 THEN INPUTEVENTS_MV.SUBJECT_ID END) AS "40-50",
    COUNT(DISTINCT CASE WHEN INPUTEVENTS_MV.PATIENTWEIGHT BETWEEN 50 AND 59.9 THEN INPUTEVENTS_MV.SUBJECT_ID END) AS "50-60",
    COUNT(DISTINCT CASE WHEN INPUTEVENTS_MV.PATIENTWEIGHT BETWEEN 60 AND 69.9 THEN INPUTEVENTS_MV.SUBJECT_ID END) AS "60-70",
    COUNT(DISTINCT CASE WHEN INPUTEVENTS_MV.PATIENTWEIGHT BETWEEN 70 AND 79.9 THEN INPUTEVENTS_MV.SUBJECT_ID END) AS "70-80",
    COUNT(DISTINCT CASE WHEN INPUTEVENTS_MV.PATIENTWEIGHT BETWEEN 80 AND 89.9 THEN INPUTEVENTS_MV.SUBJECT_ID END) AS "80-90",
    COUNT(DISTINCT CASE WHEN INPUTEVENTS_MV.PATIENTWEIGHT BETWEEN 90 AND 99.9 THEN INPUTEVENTS_MV.SUBJECT_ID END) AS "90-100",
    COUNT(DISTINCT CASE WHEN INPUTEVENTS_MV.PATIENTWEIGHT BETWEEN 100 AND 109.9 THEN INPUTEVENTS_MV.SUBJECT_ID END) AS "100-110",
    COUNT(DISTINCT CASE WHEN INPUTEVENTS_MV.PATIENTWEIGHT BETWEEN 110 AND 119.9 THEN INPUTEVENTS_MV.SUBJECT_ID END) AS "110-120",
    COUNT(DISTINCT CASE WHEN INPUTEVENTS_MV.PATIENTWEIGHT >= 120 THEN INPUTEVENTS_MV.SUBJECT_ID END) AS "120+"
FROM
    DIAGNOSES_ICD
JOIN
    D_ICD_DIAGNOSES ON DIAGNOSES_ICD.ICD9_CODE = D_ICD_DIAGNOSES.ICD9_CODE
JOIN
    INPUTEVENTS_MV ON DIAGNOSES_ICD.SUBJECT_ID = INPUTEVENTS_MV.SUBJECT_ID
WHERE
    DIAGNOSES_ICD.HADM_ID IN (
        SELECT DISTINCT HADM_ID
        FROM DIAGNOSES_ICD
        WHERE ICD9_CODE LIKE '584%'
    )
    AND DIAGNOSES_ICD.ICD9_CODE NOT LIKE '584%'
GROUP BY
    D_ICD_DIAGNOSES.SHORT_TITLE
ORDER BY
    Patient_Count DESC
LIMIT 10;
